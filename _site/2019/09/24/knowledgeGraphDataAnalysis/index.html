<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Spark for Big Data Analytics.">

    <title>Knowledge Graph for Data Mining - Sparkling Data Ocean</title>

    <link rel="canonical" href="http://localhost:4000/2019/09/24/knowledgeGraphDataAnalysis/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Sparkling Data Ocean" />
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-114694347-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-114694347-1');
    </script>

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Sparkling Data Ocean</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                
				
                <li>
                    <a href="/about/">About</a>
                </li>
				
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header" style="background-image: url('/img/pic91.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Knowledge Graph for Data Mining</h1>
                    
                    <h2 class="subheading">Building knowledge graph in Spark without SPARQL</h2>
                    
                    <span class="meta">Posted by Melenar on September 24, 2019</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

				<p><h3>Why Knowledge Graphs?</h3>

<p>
Knowledge graph was introduced by Google in 2012 then it was adapted by many companies as Enterprise Knowledge Graph. </p>
Knowledge graph is well known for:
<ul>
<li>Google Knowledge Graph - a powerful search engine</li>
<li>Enterprise Knowledge Graph - a powerful way of integrating various data</li>
</ul>

Knowledge graph concept is much wider than search and integration. In one of our posts we used knowledge graph as Mind Mapping. In this post we will show how knowledge graph can give us a deeper view on data.
</p>
<p>Traditionally knowledge graphs are using SPARQL language for data analysis.
We will show how to build a knowledge graph in Spark and explore data using Spark DataFrame and Spark GraphFrames.
</p>

<h3>Read and Clean the Data</h3>
<p>For data we use a Kaggle dataset
<i><a href="https://www.kaggle.com/momanyc/museum-collection">
‘Museum of Modern Art Collection’</a></i> with information about titles and artists of  MoMA collection. From this dataset we’ve got some data about paintings of several artists.</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">import</span> <span class="nn">org.apache.spark.ml._</span>
<span class="k">import</span> <span class="nn">org.apache.spark.ml.feature._</span>
<span class="k">import</span> <span class="nn">org.apache.spark.sql.DataFrame</span>
<span class="k">import</span> <span class="nn">org.graphframes.GraphFrame</span>
<span class="k">import</span> <span class="nn">org.apache.spark.sql.functions._</span>

<span class="k">val</span> <span class="n">data</span><span class="k">=</span><span class="n">sqlContext</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="s">"csv"</span><span class="o">).</span>
  <span class="n">option</span><span class="o">(</span><span class="s">"header"</span><span class="o">,</span><span class="s">"true"</span><span class="o">).</span><span class="n">load</span><span class="o">(</span><span class="s">"/FileStore/tables/daYes2.txt"</span><span class="o">)</span></code></pre></figure>

<p>Example:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">display</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="s">"Artist"</span><span class="o">,</span><span class="s">"ArtistBio"</span><span class="o">,</span><span class="s">"BeginDate"</span><span class="o">,</span><span class="s">"EndDate"</span><span class="o">,</span><span class="s">"Nationality"</span><span class="o">,</span><span class="s">"Gender"</span><span class="o">,</span><span class="s">"Title"</span><span class="o">,</span><span class="s">"Date"</span><span class="o">).</span><span class="n">limit</span><span class="o">(</span><span class="mi">2</span><span class="o">))</span>
<span class="nc">Joan</span> <span class="nc">Miró</span><span class="o">,(</span><span class="nc">Spanish</span><span class="o">,</span> <span class="mi">1893</span><span class="err">–</span><span class="mi">1983</span><span class="o">),(</span><span class="mi">1893</span><span class="o">),(</span><span class="mi">1983</span><span class="o">),(</span><span class="nc">Spanish</span><span class="o">),(</span><span class="nc">Male</span><span class="o">),</span>
   <span class="nc">Rope</span> <span class="n">and</span> <span class="nc">People</span><span class="o">,</span> <span class="n">I</span><span class="o">,</span><span class="nc">Barcelona</span><span class="o">,</span> <span class="nc">March</span> <span class="mi">27</span><span class="o">,</span> <span class="mi">1935</span>
<span class="nc">Paul</span> <span class="nc">Klee</span><span class="o">,(</span><span class="nc">German</span><span class="o">,</span> <span class="n">born</span> <span class="nc">Switzerland</span><span class="o">.</span> <span class="mi">1879</span><span class="err">–</span><span class="mi">1940</span><span class="o">),(</span><span class="mi">1879</span><span class="o">),(</span><span class="mi">1940</span><span class="o">),(</span><span class="nc">German</span><span class="o">),(</span><span class="nc">Male</span><span class="o">),</span>
   <span class="nc">Fire</span> <span class="n">in</span> <span class="n">the</span> <span class="nc">Evening</span><span class="o">,</span><span class="mi">1929</span></code></pre></figure>

<p><h3>Artist Nationalities</h3>
<p>In this post we will play with data about artist biographies and it the following post - about their paintings. To clean the data, first we will remove parentheses from some columns: </p>


<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">aboutArtist</span><span class="k">=</span><span class="n">data</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="s">"Artist"</span><span class="o">,</span><span class="s">"ArtistBio"</span><span class="o">,</span><span class="s">"BeginDate"</span><span class="o">,</span><span class="s">"EndDate"</span><span class="o">,</span><span class="s">"Nationality"</span><span class="o">,</span><span class="s">"Gender"</span><span class="o">).</span>
  <span class="n">distinct</span><span class="o">.</span>
  <span class="n">withColumn</span><span class="o">(</span><span class="s">"x1"</span><span class="o">,</span><span class="n">regexp_replace</span><span class="o">(</span><span class="n">col</span><span class="o">(</span><span class="s">"Nationality"</span><span class="o">),</span><span class="s">"[^A-Za-z]"</span><span class="o">,</span><span class="s">""</span><span class="o">)).</span>
  <span class="n">withColumn</span><span class="o">(</span><span class="s">"x2"</span><span class="o">,</span><span class="n">regexp_replace</span><span class="o">(</span><span class="n">col</span><span class="o">(</span><span class="s">"Gender"</span><span class="o">),</span><span class="s">"[^A-Za-z]"</span><span class="o">,</span><span class="s">""</span><span class="o">)).</span>
  <span class="n">withColumn</span><span class="o">(</span><span class="s">"x3"</span><span class="o">,</span><span class="n">regexp_replace</span><span class="o">(</span><span class="n">col</span><span class="o">(</span><span class="s">"BeginDate"</span><span class="o">),</span><span class="s">"[^0-9]"</span><span class="o">,</span><span class="s">""</span><span class="o">)).</span>
  <span class="n">withColumn</span><span class="o">(</span><span class="s">"x4"</span><span class="o">,</span><span class="n">regexp_replace</span><span class="o">(</span><span class="n">col</span><span class="o">(</span><span class="s">"EndDate"</span><span class="o">),</span><span class="s">"[^0-9]"</span><span class="o">,</span><span class="s">""</span><span class="o">)).</span>
  <span class="n">select</span><span class="o">(</span><span class="s">"Artist"</span><span class="o">,</span><span class="s">"ArtistBio"</span><span class="o">,</span><span class="s">"x3"</span><span class="o">,</span><span class="s">"x4"</span><span class="o">,</span><span class="s">"x1"</span><span class="o">,</span><span class="s">"x2"</span><span class="o">).</span>
  <span class="n">toDF</span><span class="o">(</span><span class="s">"Artist"</span><span class="o">,</span><span class="s">"ArtistBio"</span><span class="o">,</span><span class="s">"BeginDate"</span><span class="o">,</span><span class="s">"EndDate"</span><span class="o">,</span><span class="s">"Nationality"</span><span class="o">,</span><span class="s">"Gender"</span><span class="o">)</span>

<span class="nc">Vasily</span> <span class="nc">Kandinsky</span><span class="o">,</span><span class="s">"(French, born Russia. 1866–1944)"</span><span class="o">,</span><span class="mi">1866</span><span class="o">,</span><span class="mi">1944</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Male</span>
<span class="nc">Franz</span> <span class="nc">Marc</span><span class="o">,</span><span class="s">"(German, 1880–1916)"</span><span class="o">,</span><span class="mi">1880</span><span class="o">,</span><span class="mi">1916</span><span class="o">,</span><span class="nc">German</span><span class="o">,</span><span class="nc">Male</span>
<span class="nc">Henri</span> <span class="nc">Matisse</span><span class="o">,</span><span class="s">"(French, 1869–1954)"</span><span class="o">,</span><span class="mi">1869</span><span class="o">,</span><span class="mi">1954</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Male</span>
<span class="nc">Joan</span> <span class="nc">Miró</span><span class="o">,</span><span class="s">"(Spanish, 1893–1983)"</span><span class="o">,</span><span class="mi">1893</span><span class="o">,</span><span class="mi">1983</span><span class="o">,</span><span class="nc">Spanish</span><span class="o">,</span><span class="nc">Male</span>
<span class="nc">Egon</span> <span class="nc">Schiele</span><span class="o">,</span><span class="s">"(Austrian, 1890–1918)"</span><span class="o">,</span><span class="mi">1890</span><span class="o">,</span><span class="mi">1918</span><span class="o">,</span><span class="nc">Austrian</span><span class="o">,</span><span class="nc">Male</span>
<span class="nc">Marc</span> <span class="nc">Chagall</span><span class="o">,</span><span class="s">"(French, born Belarus. 1887–1985)"</span><span class="o">,</span><span class="mi">1887</span><span class="o">,</span><span class="mi">1985</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Male</span>
<span class="nc">Vincent</span> <span class="n">van</span> <span class="nc">Gogh</span><span class="o">,</span><span class="s">"(Dutch, 1853–1890)"</span><span class="o">,</span><span class="mi">1853</span><span class="o">,</span><span class="mi">1890</span><span class="o">,</span><span class="nc">Dutch</span><span class="o">,</span><span class="nc">Male</span>
<span class="nc">Jackson</span> <span class="nc">Pollock</span><span class="o">,</span><span class="s">"(American, 1912–1956)"</span><span class="o">,</span><span class="mi">1912</span><span class="o">,</span><span class="mi">1956</span><span class="o">,</span><span class="nc">American</span><span class="o">,</span><span class="nc">Male</span>
<span class="nc">Paul</span> <span class="nc">Signac</span><span class="o">,</span><span class="s">"(French, 1863–1935)"</span><span class="o">,</span><span class="mi">1863</span><span class="o">,</span><span class="mi">1935</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Male</span>
<span class="nc">Paul</span> <span class="nc">Cézanne</span><span class="o">,</span><span class="s">"(French, 1839–1906)"</span><span class="o">,</span><span class="mi">1839</span><span class="o">,</span><span class="mi">1906</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Male</span>
<span class="nc">Kazimir</span> <span class="nc">Malevich</span><span class="o">,</span><span class="s">"(Russian, born Ukraine. 1878–1935)"</span><span class="o">,</span><span class="mi">1878</span><span class="o">,</span><span class="mi">1935</span><span class="o">,</span><span class="nc">Russian</span><span class="o">,</span><span class="nc">Male</span>
<span class="nc">Georges</span> <span class="nc">Braque</span><span class="o">,</span><span class="s">"(French, 1882–1963)"</span><span class="o">,</span><span class="mi">1882</span><span class="o">,</span><span class="mi">1963</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Male</span>
<span class="nc">Natalia</span> <span class="nc">Goncharova</span><span class="o">,</span><span class="s">"(Russian, 1881–1962)"</span><span class="o">,</span><span class="mi">1881</span><span class="o">,</span><span class="mi">1962</span><span class="o">,</span><span class="nc">Russian</span><span class="o">,</span><span class="nc">Female</span>
<span class="nc">Max</span> <span class="nc">Beckmann</span><span class="o">,</span><span class="s">"(German, 1884–1950)"</span><span class="o">,</span><span class="mi">1884</span><span class="o">,</span><span class="mi">1950</span><span class="o">,</span><span class="nc">German</span><span class="o">,</span><span class="nc">Male</span>
<span class="nc">Piet</span> <span class="nc">Mondrian</span><span class="o">,</span><span class="s">"(Dutch, 1872–1944)"</span><span class="o">,</span><span class="mi">1872</span><span class="o">,</span><span class="mi">1944</span><span class="o">,</span><span class="nc">Dutch</span><span class="o">,</span><span class="nc">Male</span>
<span class="nc">Paul</span> <span class="nc">Klee</span><span class="o">,</span><span class="s">"(German, born Switzerland. 1879–1940)"</span><span class="o">,</span><span class="mi">1879</span><span class="o">,</span><span class="mi">1940</span><span class="o">,</span><span class="nc">German</span><span class="o">,</span><span class="nc">Male</span>
<span class="nc">Claude</span> <span class="nc">Monet</span><span class="o">,</span><span class="s">"(French, 1840–1926)"</span><span class="o">,</span><span class="mi">1840</span><span class="o">,</span><span class="mi">1926</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Male</span>
<span class="nc">Pablo</span> <span class="nc">Picasso</span><span class="o">,</span><span class="s">"(Spanish, 1881–1973)"</span><span class="o">,</span><span class="mi">1881</span><span class="o">,</span><span class="mi">1973</span><span class="o">,</span><span class="nc">Spanish</span><span class="o">,</span><span class="nc">Male</span>
<span class="nc">Paul</span> <span class="nc">Gauguin</span><span class="o">,</span><span class="s">"(French, 1848–1903)"</span><span class="o">,</span><span class="mi">1848</span><span class="o">,</span><span class="mi">1903</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Male</span>
<span class="nc">Oskar</span> <span class="nc">Kokoschka</span><span class="o">,</span><span class="s">"(Austrian, 1886–1980)"</span><span class="o">,</span><span class="mi">1886</span><span class="o">,</span><span class="mi">1980</span><span class="o">,</span><span class="nc">Austrian</span><span class="o">,</span><span class="nc">Male</span></code></pre></figure>


<p>For the first knowledge graph for data exploration we will use columns 'Artist' and 'Nationality'. First we'll create graph vertices (nodes):  </p>


<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">graphNodesNationality</span><span class="k">=</span><span class="n">aboutArtist</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="s">"Artist"</span><span class="o">).</span>
  <span class="n">union</span><span class="o">(</span><span class="n">aboutArtist</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="s">"Nationality"</span><span class="o">)).</span><span class="n">distinct</span><span class="o">.</span><span class="n">toDF</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span></code></pre></figure>


<p>Next we'll create graph edges in (subject, object, predicate) form. As a predicate we will use the column name 'Nationality':  </p>


<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">graphEdgesNationality</span><span class="k">=</span><span class="n">aboutArtist</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="s">"Artist"</span><span class="o">,</span><span class="s">"Nationality"</span><span class="o">).</span>
  <span class="n">toDF</span><span class="o">(</span><span class="s">"src"</span><span class="o">,</span><span class="s">"dst"</span><span class="o">).</span><span class="n">withColumn</span><span class="o">(</span><span class="s">"edgeId"</span><span class="o">,</span><span class="n">lit</span><span class="o">(</span><span class="s">"Nationality"</span><span class="o">)).</span>
  <span class="n">distinct</span></code></pre></figure>



<p>Build a knowledge graph:  </p>


<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">graphNationality</span> <span class="k">=</span> <span class="nc">GraphFrame</span><span class="o">(</span><span class="n">graphNodesNationality</span><span class="o">,</span><span class="n">graphEdgesNationality</span><span class="o">)</span></code></pre></figure>


<p>See graph vertices:  </p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">display</span><span class="o">(</span><span class="n">graphNationality</span><span class="o">.</span><span class="n">vertices</span><span class="o">)</span>
<span class="nc">Georges</span> <span class="nc">Braque</span>
<span class="nc">Pablo</span> <span class="nc">Picasso</span>
<span class="nc">Egon</span> <span class="nc">Schiele</span>
<span class="nc">Kazimir</span> <span class="nc">Malevich</span>
<span class="nc">Jackson</span> <span class="nc">Pollock</span>
<span class="nc">Marc</span> <span class="nc">Chagall</span>
<span class="nc">Natalia</span> <span class="nc">Goncharova</span>
<span class="nc">Paul</span> <span class="nc">Signac</span>
<span class="nc">Franz</span> <span class="nc">Marc</span>
<span class="nc">Piet</span> <span class="nc">Mondrian</span>
<span class="nc">Vincent</span> <span class="n">van</span> <span class="nc">Gogh</span>
<span class="nc">Paul</span> <span class="nc">Cézanne</span>
<span class="nc">Vasily</span> <span class="nc">Kandinsky</span>
<span class="nc">Paul</span> <span class="nc">Klee</span>
<span class="nc">Henri</span> <span class="nc">Matisse</span>
<span class="nc">Claude</span> <span class="nc">Monet</span>
<span class="nc">Oskar</span> <span class="nc">Kokoschka</span>
<span class="nc">Paul</span> <span class="nc">Gauguin</span>
<span class="nc">Max</span> <span class="nc">Beckmann</span>
<span class="nc">Joan</span> <span class="nc">Miró</span>
<span class="nc">American</span>
<span class="nc">Austrian</span>
<span class="nc">Dutch</span>
<span class="nc">French</span>
<span class="nc">German</span>
<span class="nc">Russian</span>
<span class="nc">Spanish</span></code></pre></figure>


<p>See graph edges:  </p>


<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">display</span><span class="o">(</span><span class="n">graphNationality</span><span class="o">.</span><span class="n">edges</span><span class="o">)</span>
<span class="n">src</span><span class="o">,</span><span class="n">dst</span><span class="o">,</span><span class="n">edgeId</span>
<span class="nc">Vincent</span> <span class="n">van</span> <span class="nc">Gogh</span><span class="o">,</span><span class="nc">Dutch</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Claude</span> <span class="nc">Monet</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Paul</span> <span class="nc">Gauguin</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Paul</span> <span class="nc">Cézanne</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Egon</span> <span class="nc">Schiele</span><span class="o">,</span><span class="nc">Austrian</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Paul</span> <span class="nc">Klee</span><span class="o">,</span><span class="nc">German</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Natalia</span> <span class="nc">Goncharova</span><span class="o">,</span><span class="nc">Russian</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Piet</span> <span class="nc">Mondrian</span><span class="o">,</span><span class="nc">Dutch</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Henri</span> <span class="nc">Matisse</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Franz</span> <span class="nc">Marc</span><span class="o">,</span><span class="nc">German</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Kazimir</span> <span class="nc">Malevich</span><span class="o">,</span><span class="nc">Russian</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Vasily</span> <span class="nc">Kandinsky</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Paul</span> <span class="nc">Signac</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Pablo</span> <span class="nc">Picasso</span><span class="o">,</span><span class="nc">Spanish</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Oskar</span> <span class="nc">Kokoschka</span><span class="o">,</span><span class="nc">Austrian</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Max</span> <span class="nc">Beckmann</span><span class="o">,</span><span class="nc">German</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Joan</span> <span class="nc">Miró</span><span class="o">,</span><span class="nc">Spanish</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Georges</span> <span class="nc">Braque</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Jackson</span> <span class="nc">Pollock</span><span class="o">,</span><span class="nc">American</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Marc</span> <span class="nc">Chagall</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Nationality</span></code></pre></figure>


<p>For graph visualization we will use Gephi. Function to translate graph edges to dot language:</p>


<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">def</span> <span class="n">graph2dot</span><span class="o">(</span><span class="n">graph</span><span class="k">:</span> <span class="kt">GraphFrame</span><span class="o">)</span><span class="k">:</span> <span class="kt">DataFrame</span> <span class="o">=</span> <span class="o">{</span>
  <span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">distinct</span><span class="o">.</span>
    <span class="n">map</span><span class="o">(</span><span class="n">s</span><span class="o">=&gt;(</span><span class="s">"\""</span><span class="o">+</span><span class="n">s</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="n">toString</span> <span class="o">+</span><span class="s">"\" -&gt; \""</span>
      <span class="o">+</span><span class="n">s</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="n">toString</span> <span class="o">+</span><span class="s">"\""</span><span class="o">+</span><span class="s">" [label=\""</span><span class="o">+(</span><span class="n">s</span><span class="o">(</span><span class="mi">2</span><span class="o">).</span><span class="n">toString</span><span class="o">)+</span><span class="s">"\"];"</span><span class="o">)).</span>
      <span class="n">toDF</span><span class="o">(</span><span class="s">"dotLine"</span><span class="o">)</span>  
<span class="o">}</span></code></pre></figure>


<p>Translate graph edges to dot language:</p>


<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">display</span><span class="o">(</span><span class="n">graph2dot</span><span class="o">(</span><span class="n">graphNationality</span><span class="o">))</span>

<span class="s">"Vincent van Gogh"</span> <span class="o">-&gt;</span> <span class="s">"Dutch"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">Nationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Claude Monet"</span> <span class="o">-&gt;</span> <span class="s">"French"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">Nationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Paul Gauguin"</span> <span class="o">-&gt;</span> <span class="s">"French"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">Nationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Paul Cézanne"</span> <span class="o">-&gt;</span> <span class="s">"French"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">Nationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Egon Schiele"</span> <span class="o">-&gt;</span> <span class="s">"Austrian"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">Nationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Paul Klee"</span> <span class="o">-&gt;</span> <span class="s">"German"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">Nationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Natalia Goncharova"</span> <span class="o">-&gt;</span> <span class="s">"Russian"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">Nationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Piet Mondrian"</span> <span class="o">-&gt;</span> <span class="s">"Dutch"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">Nationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Henri Matisse"</span> <span class="o">-&gt;</span> <span class="s">"French"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">Nationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Franz Marc"</span> <span class="o">-&gt;</span> <span class="s">"German"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">Nationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Kazimir Malevich"</span> <span class="o">-&gt;</span> <span class="s">"Russian"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">Nationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Vasily Kandinsky"</span> <span class="o">-&gt;</span> <span class="s">"French"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">Nationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Paul Signac"</span> <span class="o">-&gt;</span> <span class="s">"French"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">Nationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Pablo Picasso"</span> <span class="o">-&gt;</span> <span class="s">"Spanish"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">Nationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Oskar Kokoschka"</span> <span class="o">-&gt;</span> <span class="s">"Austrian"</span> <span class="o">[</span><span class="kt">laBornbel=</span><span class="err">"</span><span class="kt">Nationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Max Beckmann"</span> <span class="o">-&gt;</span> <span class="s">"German"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">Nationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Joan Miró"</span> <span class="o">-&gt;</span> <span class="s">"Spanish"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">Nationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Georges Braque"</span> <span class="o">-&gt;</span> <span class="s">"French"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">Nationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Jackson Pollock"</span> <span class="o">-&gt;</span> <span class="s">"American"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">Nationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Marc Chagall"</span> <span class="o">-&gt;</span> <span class="s">"French"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">Nationality</span><span class="err">"</span><span class="o">];</span></code></pre></figure>


<p>Knowledge graph for Artist Nationalities:</p>


<a href="#">
    <img src="/img/moma2.jpg" alt="Post Sample Image" width="560" height="500" />
</a>


<p><h3>Countries of Birth </h3>
<p>
Next we will look at countries where artists were born. ArtistBio mentions born in country only if artists's nationality has changes. So we will get a country of birth from ArtistBio column:
</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">artistData1</span><span class="k">=</span><span class="n">aboutArtist</span><span class="o">.</span><span class="n">filter</span><span class="o">(</span><span class="n">col</span><span class="o">(</span><span class="s">"ArtistBio"</span><span class="o">).</span><span class="n">rlike</span><span class="o">(</span><span class="s">"born "</span><span class="o">)).</span>
  <span class="n">withColumn</span><span class="o">(</span><span class="s">"bornHs"</span><span class="o">,</span><span class="n">split</span><span class="o">(</span><span class="n">$</span><span class="s">"ArtistBio"</span><span class="o">,</span><span class="s">"born "</span><span class="o">)(</span><span class="mi">1</span><span class="o">)).</span>
  <span class="n">withColumn</span><span class="o">(</span><span class="s">"bornCountry"</span><span class="o">,</span><span class="n">split</span><span class="o">(</span><span class="n">$</span><span class="s">"bornHs"</span><span class="o">,</span><span class="s">". 1"</span><span class="o">)(</span><span class="mi">0</span><span class="o">)).</span><span class="n">drop</span><span class="o">(</span><span class="s">"bornHs"</span><span class="o">)</span>

<span class="nc">Artist</span><span class="o">,</span><span class="nc">ArtistBio</span><span class="o">,</span><span class="nc">BeginDate</span><span class="o">,</span><span class="nc">EndDate</span><span class="o">,</span><span class="nc">Nationality</span><span class="o">,</span><span class="nc">Gender</span><span class="o">,</span><span class="n">bornCountry</span>
<span class="nc">Vasily</span> <span class="nc">Kandinsky</span><span class="o">,</span><span class="s">"(French, born Russia. 1866–1944)"</span><span class="o">,</span><span class="mi">1866</span><span class="o">,</span><span class="mi">1944</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">Russia</span>
<span class="nc">Marc</span> <span class="nc">Chagall</span><span class="o">,</span><span class="s">"(French, born Belarus. 1887–1985)"</span><span class="o">,</span><span class="mi">1887</span><span class="o">,</span><span class="mi">1985</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">Belarus</span>
<span class="nc">Kazimir</span> <span class="nc">Malevich</span><span class="o">,</span><span class="s">"(Russian, born Ukraine. 1878–1935)"</span><span class="o">,</span><span class="mi">1878</span><span class="o">,</span><span class="mi">1935</span><span class="o">,</span><span class="nc">Russian</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">Ukraine</span>
<span class="nc">Paul</span> <span class="nc">Klee</span><span class="o">,</span><span class="s">"(German, born Switzerland. 1879–1940)"</span><span class="o">,</span><span class="mi">1879</span><span class="o">,</span><span class="mi">1940</span><span class="o">,</span><span class="nc">German</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">Switzerland</span></code></pre></figure>


<p>When born country is not mentioned in Artist Bio column we will translate artist's nationality to country of birth based on nationality to country mapping:</p>


<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">nationality2country</span><span class="k">=</span><span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span>
  <span class="o">(</span><span class="s">"French"</span><span class="o">,</span><span class="s">"France"</span><span class="o">),</span>
  <span class="o">(</span><span class="s">"Russian"</span><span class="o">,</span><span class="s">"Russia"</span><span class="o">),</span>
  <span class="o">(</span><span class="s">"German"</span><span class="o">,</span><span class="s">"Germany"</span><span class="o">),</span>
  <span class="o">(</span><span class="s">"American"</span><span class="o">,</span><span class="s">"USA"</span><span class="o">),</span>
  <span class="o">(</span><span class="s">"Dutch"</span><span class="o">,</span><span class="s">"Netherlands"</span><span class="o">),</span>
  <span class="o">(</span><span class="s">"Spanish"</span><span class="o">,</span><span class="s">"Spain"</span><span class="o">),</span>
  <span class="o">(</span><span class="s">"Austrian"</span><span class="o">,</span><span class="s">"Austria"</span><span class="o">),</span>
  <span class="o">(</span><span class="s">"Ukrainian"</span><span class="o">,</span><span class="s">"Ukraine"</span><span class="o">),</span>
  <span class="o">(</span><span class="s">"Belarusian"</span><span class="o">,</span><span class="s">"Belarus"</span><span class="o">),</span>
  <span class="o">(</span><span class="s">"Swiss"</span><span class="o">,</span><span class="s">"Switzerland"</span><span class="o">)</span>
  <span class="o">)).</span><span class="n">toDF</span><span class="o">(</span><span class="s">"nation"</span><span class="o">,</span><span class="s">"country"</span><span class="o">)</span>
<span class="n">display</span><span class="o">(</span><span class="n">nationality2country</span><span class="o">)</span>

<span class="k">val</span> <span class="n">artistData2</span><span class="k">=</span><span class="n">aboutArtist</span><span class="o">.</span><span class="n">filter</span><span class="o">(</span><span class="n">not</span><span class="o">(</span><span class="n">col</span><span class="o">(</span><span class="s">"ArtistBio"</span><span class="o">).</span><span class="n">rlike</span><span class="o">(</span><span class="s">"born "</span><span class="o">))).</span>
  <span class="n">join</span><span class="o">(</span><span class="n">nationality2country</span><span class="o">,</span><span class="n">col</span><span class="o">(</span><span class="s">"Nationality"</span><span class="o">).</span><span class="n">contains</span><span class="o">(</span><span class="n">col</span><span class="o">(</span><span class="s">"nation"</span><span class="o">))).</span>
  <span class="n">drop</span><span class="o">(</span><span class="s">"nation"</span><span class="o">)</span>

<span class="nc">Artist</span><span class="o">,</span><span class="nc">ArtistBio</span><span class="o">,</span><span class="nc">BeginDate</span><span class="o">,</span><span class="nc">EndDate</span><span class="o">,</span><span class="nc">Nationality</span><span class="o">,</span><span class="nc">Gender</span><span class="o">,</span><span class="n">country</span>
<span class="nc">Paul</span> <span class="nc">Gauguin</span><span class="o">,</span><span class="s">"(French, 1848–1903)"</span><span class="o">,</span><span class="mi">1848</span><span class="o">,</span><span class="mi">1903</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">France</span>
<span class="nc">Claude</span> <span class="nc">Monet</span><span class="o">,</span><span class="s">"(French, 1840–1926)"</span><span class="o">,</span><span class="mi">1840</span><span class="o">,</span><span class="mi">1926</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">France</span>
<span class="nc">Georges</span> <span class="nc">Braque</span><span class="o">,</span><span class="s">"(French, 1882–1963)"</span><span class="o">,</span><span class="mi">1882</span><span class="o">,</span><span class="mi">1963</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">France</span>
<span class="nc">Paul</span> <span class="nc">Cézanne</span><span class="o">,</span><span class="s">"(French, 1839–1906)"</span><span class="o">,</span><span class="mi">1839</span><span class="o">,</span><span class="mi">1906</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">France</span>
<span class="nc">Paul</span> <span class="nc">Signac</span><span class="o">,</span><span class="s">"(French, 1863–1935)"</span><span class="o">,</span><span class="mi">1863</span><span class="o">,</span><span class="mi">1935</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">France</span>
<span class="nc">Henri</span> <span class="nc">Matisse</span><span class="o">,</span><span class="s">"(French, 1869–1954)"</span><span class="o">,</span><span class="mi">1869</span><span class="o">,</span><span class="mi">1954</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">France</span>
<span class="nc">Natalia</span> <span class="nc">Goncharova</span><span class="o">,</span><span class="s">"(Russian, 1881–1962)"</span><span class="o">,</span><span class="mi">1881</span><span class="o">,</span><span class="mi">1962</span><span class="o">,</span><span class="nc">Russian</span><span class="o">,</span><span class="nc">Female</span><span class="o">,</span><span class="nc">Russia</span>
<span class="nc">Max</span> <span class="nc">Beckmann</span><span class="o">,</span><span class="s">"(German, 1884–1950)"</span><span class="o">,</span><span class="mi">1884</span><span class="o">,</span><span class="mi">1950</span><span class="o">,</span><span class="nc">German</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">Germany</span>
<span class="nc">Franz</span> <span class="nc">Marc</span><span class="o">,</span><span class="s">"(German, 1880–1916)"</span><span class="o">,</span><span class="mi">1880</span><span class="o">,</span><span class="mi">1916</span><span class="o">,</span><span class="nc">German</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">Germany</span>
<span class="nc">Jackson</span> <span class="nc">Pollock</span><span class="o">,</span><span class="s">"(American, 1912–1956)"</span><span class="o">,</span><span class="mi">1912</span><span class="o">,</span><span class="mi">1956</span><span class="o">,</span><span class="nc">American</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">USA</span>
<span class="nc">Piet</span> <span class="nc">Mondrian</span><span class="o">,</span><span class="s">"(Dutch, 1872–1944)"</span><span class="o">,</span><span class="mi">1872</span><span class="o">,</span><span class="mi">1944</span><span class="o">,</span><span class="nc">Dutch</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">Netherlands</span>
<span class="nc">Vincent</span> <span class="n">van</span> <span class="nc">Gogh</span><span class="o">,</span><span class="s">"(Dutch, 1853–1890)"</span><span class="o">,</span><span class="mi">1853</span><span class="o">,</span><span class="mi">1890</span><span class="o">,</span><span class="nc">Dutch</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">Netherlands</span>
<span class="nc">Pablo</span> <span class="nc">Picasso</span><span class="o">,</span><span class="s">"(Spanish, 1881–1973)"</span><span class="o">,</span><span class="mi">1881</span><span class="o">,</span><span class="mi">1973</span><span class="o">,</span><span class="nc">Spanish</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">Spain</span>
<span class="nc">Joan</span> <span class="nc">Miró</span><span class="o">,</span><span class="s">"(Spanish, 1893–1983)"</span><span class="o">,</span><span class="mi">1893</span><span class="o">,</span><span class="mi">1983</span><span class="o">,</span><span class="nc">Spanish</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">Spain</span>
<span class="nc">Oskar</span> <span class="nc">Kokoschka</span><span class="o">,</span><span class="s">"(Austrian, 1886–1980)"</span><span class="o">,</span><span class="mi">1886</span><span class="o">,</span><span class="mi">1980</span><span class="o">,</span><span class="nc">Austrian</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">Austria</span>
<span class="nc">Egon</span> <span class="nc">Schiele</span><span class="o">,</span><span class="s">"(Austrian, 1890–1918)"</span><span class="o">,</span><span class="mi">1890</span><span class="o">,</span><span class="mi">1918</span><span class="o">,</span><span class="nc">Austrian</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">Austria</span></code></pre></figure>


<p>Combine the tables and build a graph.</p>


<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">artistData</span><span class="k">=</span><span class="n">artistData1</span><span class="o">.</span><span class="n">union</span><span class="o">(</span><span class="n">artistData2</span><span class="o">)</span>  

<span class="k">val</span> <span class="n">graphNodesBornCountry</span><span class="k">=</span><span class="n">artistData</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="s">"Artist"</span><span class="o">).</span>
  <span class="n">union</span><span class="o">(</span><span class="n">artistData</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="s">"bornCountry"</span><span class="o">)).</span><span class="n">distinct</span><span class="o">.</span><span class="n">toDF</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span>
<span class="k">val</span> <span class="n">graphEdgesBornCountry</span><span class="k">=</span><span class="n">artistData</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="s">"Artist"</span><span class="o">,</span><span class="s">"bornCountry"</span><span class="o">).</span><span class="n">toDF</span><span class="o">(</span><span class="s">"src"</span><span class="o">,</span><span class="s">"dst"</span><span class="o">).</span>
  <span class="n">withColumn</span><span class="o">(</span><span class="s">"edgeId"</span><span class="o">,</span><span class="n">lit</span><span class="o">(</span><span class="s">"bornCountry"</span><span class="o">)).</span>
  <span class="n">distinct</span>
<span class="k">val</span> <span class="n">graphBornCountry</span> <span class="k">=</span> <span class="nc">GraphFrame</span><span class="o">(</span><span class="n">graphNodesBornCountry</span><span class="o">,</span><span class="n">graphEdgesBornCountry</span><span class="o">)</span>
<span class="n">display</span><span class="o">(</span><span class="n">graph2dot</span><span class="o">(</span><span class="n">graphBornCountry</span><span class="o">))</span>

<span class="s">"Pablo Picasso"</span> <span class="o">-&gt;</span> <span class="s">"Spain"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Claude Monet"</span> <span class="o">-&gt;</span> <span class="s">"France"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Marc Chagall"</span> <span class="o">-&gt;</span> <span class="s">"Belarus"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Kazimir Malevich"</span> <span class="o">-&gt;</span> <span class="s">"Ukraine"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Paul Cézanne"</span> <span class="o">-&gt;</span> <span class="s">"France"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Oskar Kokoschka"</span> <span class="o">-&gt;</span> <span class="s">"Austria"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Piet Mondrian"</span> <span class="o">-&gt;</span> <span class="s">"Netherlands"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Henri Matisse"</span> <span class="o">-&gt;</span> <span class="s">"France"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Vincent van Gogh"</span> <span class="o">-&gt;</span> <span class="s">"Netherlands"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Paul Klee"</span> <span class="o">-&gt;</span> <span class="s">"Switzerland"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Georges Braque"</span> <span class="o">-&gt;</span> <span class="s">"France"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Jackson Pollock"</span> <span class="o">-&gt;</span> <span class="s">"USA"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Vasily Kandinsky"</span> <span class="o">-&gt;</span> <span class="s">"Russia"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Paul Signac"</span> <span class="o">-&gt;</span> <span class="s">"France"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Joan Miró"</span> <span class="o">-&gt;</span> <span class="s">"Spain"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Paul Gauguin"</span> <span class="o">-&gt;</span> <span class="s">"France"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Max Beckmann"</span> <span class="o">-&gt;</span> <span class="s">"Germany"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Franz Marc"</span> <span class="o">-&gt;</span> <span class="s">"Germany"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Natalia Goncharova"</span> <span class="o">-&gt;</span> <span class="s">"Russia"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Egon Schiele"</span> <span class="o">-&gt;</span> <span class="s">"Austria"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornCountry</span><span class="err">"</span><span class="o">];</span></code></pre></figure>


<p>Where artists were born?</p>

<a href="#">
    <img src="/img/moma1.jpg" alt="Post Sample Image" width="600" height="500" />
</a>

<p>When you see in art museum in what country an artist was born, you rather see a country what artist's place of birth currently belongs to. Some of such countries did not exist at the time when artists were born. For example when Mark Chagall was born near Vitebsk, Russian Empire, present-day Belarus.
To change current country names to historical country names, we will change "Russia","Ukraine","Belarus" country names to "Russian Empire" and rebuild a graph:</p>


<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">artistBornData</span> <span class="k">=</span><span class="n">artistData</span><span class="o">.</span>
  <span class="n">withColumn</span><span class="o">(</span><span class="s">"bornInCountry"</span><span class="o">,</span><span class="n">when</span><span class="o">(</span><span class="n">col</span><span class="o">(</span><span class="s">"bornCountry"</span><span class="o">).</span>
  <span class="n">isin</span><span class="o">(</span><span class="s">"Russia"</span><span class="o">,</span><span class="s">"Ukraine"</span><span class="o">,</span><span class="s">"Belarus"</span><span class="o">),</span><span class="s">"Russian Empire"</span><span class="o">).</span>
  <span class="n">otherwise</span><span class="o">(</span><span class="n">col</span><span class="o">(</span><span class="s">"bornCountry"</span><span class="o">))).</span><span class="n">drop</span><span class="o">(</span><span class="s">"bornCountry"</span><span class="o">)</span>

<span class="k">val</span> <span class="n">graphNodesBornCountry</span><span class="k">=</span><span class="n">artistBornData</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="s">"Artist"</span><span class="o">).</span>
  <span class="n">union</span><span class="o">(</span><span class="n">artistBornData</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="s">"bornInCountry"</span><span class="o">)).</span><span class="n">distinct</span><span class="o">.</span><span class="n">toDF</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span>
<span class="k">val</span> <span class="n">graphEdgesBornCountry</span><span class="k">=</span><span class="n">artistBornData</span><span class="o">.</span>
  <span class="n">select</span><span class="o">(</span><span class="s">"Artist"</span><span class="o">,</span><span class="s">"bornInCountry"</span><span class="o">).</span><span class="n">toDF</span><span class="o">(</span><span class="s">"src"</span><span class="o">,</span><span class="s">"dst"</span><span class="o">).</span>
  <span class="n">withColumn</span><span class="o">(</span><span class="s">"edgeId"</span><span class="o">,</span><span class="n">lit</span><span class="o">(</span><span class="s">"bornInCountry"</span><span class="o">)).</span>
  <span class="n">distinct</span>
<span class="k">val</span> <span class="n">graphBornCountry</span> <span class="k">=</span> <span class="nc">GraphFrame</span><span class="o">(</span><span class="n">graphNodesBornCountry</span><span class="o">,</span><span class="n">graphEdgesBornCountry</span><span class="o">)</span>
  <span class="n">display</span><span class="o">(</span><span class="n">graph2dot</span><span class="o">(</span><span class="n">graphBornCountry</span><span class="o">))</span>

<span class="s">"Vincent van Gogh"</span> <span class="o">-&gt;</span> <span class="s">"Netherlands"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornInCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Kazimir Malevich"</span> <span class="o">-&gt;</span> <span class="s">"Russian Empire"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornInCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Jackson Pollock"</span> <span class="o">-&gt;</span> <span class="s">"USA"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornInCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Natalia Goncharova"</span> <span class="o">-&gt;</span> <span class="s">"Russian Empire"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornInCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Pablo Picasso"</span> <span class="o">-&gt;</span> <span class="s">"Spain"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornInCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Paul Klee"</span> <span class="o">-&gt;</span> <span class="s">"Switzerland"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornInCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Paul Signac"</span> <span class="o">-&gt;</span> <span class="s">"France"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornInCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Franz Marc"</span> <span class="o">-&gt;</span> <span class="s">"Germany"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornInCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Marc Chagall"</span> <span class="o">-&gt;</span> <span class="s">"Russian Empire"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornInCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Piet Mondrian"</span> <span class="o">-&gt;</span> <span class="s">"Netherlands"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornInCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Oskar Kokoschka"</span> <span class="o">-&gt;</span> <span class="s">"Austria"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornInCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Vasily Kandinsky"</span> <span class="o">-&gt;</span> <span class="s">"Russian Empire"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornInCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Max Beckmann"</span> <span class="o">-&gt;</span> <span class="s">"Germany"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornInCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Henri Matisse"</span> <span class="o">-&gt;</span> <span class="s">"France"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornInCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Claude Monet"</span> <span class="o">-&gt;</span> <span class="s">"France"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornInCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Georges Braque"</span> <span class="o">-&gt;</span> <span class="s">"France"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornInCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Egon Schiele"</span> <span class="o">-&gt;</span> <span class="s">"Austria"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornInCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Joan Miró"</span> <span class="o">-&gt;</span> <span class="s">"Spain"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornInCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Paul Gauguin"</span> <span class="o">-&gt;</span> <span class="s">"France"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornInCountry</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Paul Cézanne"</span> <span class="o">-&gt;</span> <span class="s">"France"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornInCountry</span><span class="err">"</span><span class="o">];</span></code></pre></figure>


Historical birth country names:
<a href="#">
    <img src="/img/moma4.jpg" alt="Post Sample Image" width="678" height="500" />
</a>

<p><h3>Born Nationality</h3>
Now we can look at artists' nationalities when they were born. We'll add 'Russian Empire' to nationality to country mapping:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">nationality2countryHistory</span><span class="k">=</span><span class="n">nationality2country</span><span class="o">.</span>
  <span class="n">filter</span><span class="o">(</span><span class="n">not</span><span class="o">(</span><span class="ss">'country.</span><span class="n">isin</span><span class="o">(</span><span class="s">"Ukraine"</span><span class="o">,</span><span class="s">"Belarus"</span><span class="o">))).</span>
  <span class="n">withColumn</span><span class="o">(</span><span class="s">"countryHistory"</span><span class="o">,</span>
    <span class="n">when</span><span class="o">(</span><span class="n">col</span><span class="o">(</span><span class="s">"country"</span><span class="o">)===</span><span class="s">"Russia"</span><span class="o">,</span><span class="s">"Russian Empire"</span><span class="o">).</span><span class="n">otherwise</span><span class="o">(</span><span class="n">col</span><span class="o">(</span><span class="s">"country"</span><span class="o">))).</span>
  <span class="n">drop</span><span class="o">(</span><span class="s">"country"</span><span class="o">).</span><span class="n">toDF</span><span class="o">(</span><span class="s">"bornNationality"</span><span class="o">,</span><span class="s">"countryHistory"</span><span class="o">)</span>

<span class="k">val</span> <span class="n">artistBornNationality</span><span class="k">=</span><span class="n">artistBornData</span><span class="o">.</span>
  <span class="n">join</span><span class="o">(</span><span class="n">nationality2countryHistory</span><span class="o">,</span>
  <span class="n">col</span><span class="o">(</span><span class="s">"bornInCountry"</span><span class="o">)===</span><span class="n">col</span><span class="o">(</span><span class="s">"countryHistory"</span><span class="o">)).</span>
  <span class="n">drop</span><span class="o">(</span><span class="s">"countryHistory"</span><span class="o">)</span></code></pre></figure>


<p>Build a graph </p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">graphNodesBornNationality</span><span class="k">=</span><span class="n">artistBornNationality</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="s">"Artist"</span><span class="o">).</span>  
  <span class="n">union</span><span class="o">(</span><span class="n">artistBornNationality</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="s">"bornNationality"</span><span class="o">)).</span><span class="n">distinct</span><span class="o">.</span><span class="n">toDF</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span>
<span class="k">val</span> <span class="n">graphEdgesBornNationality</span><span class="k">=</span><span class="n">artistBornNationality</span><span class="o">.</span>
  <span class="n">select</span><span class="o">(</span><span class="s">"Artist"</span><span class="o">,</span><span class="s">"bornNationality"</span><span class="o">).</span><span class="n">toDF</span><span class="o">(</span><span class="s">"src"</span><span class="o">,</span><span class="s">"dst"</span><span class="o">).</span>
  <span class="n">withColumn</span><span class="o">(</span><span class="s">"edgeId"</span><span class="o">,</span><span class="n">lit</span><span class="o">(</span><span class="s">"bornNationality"</span><span class="o">)).</span>
  <span class="n">distinct</span>
<span class="k">val</span> <span class="n">graphBornNationality</span> <span class="k">=</span> <span class="nc">GraphFrame</span><span class="o">(</span><span class="n">graphNodesBornNationality</span><span class="o">,</span><span class="n">graphEdgesBornNationality</span><span class="o">)</span>

<span class="s">"Vincent van Gogh"</span> <span class="o">-&gt;</span> <span class="s">"Dutch"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornNationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Paul Signac"</span> <span class="o">-&gt;</span> <span class="s">"French"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornNationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Pablo Picasso"</span> <span class="o">-&gt;</span> <span class="s">"Spanish"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornNationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Jackson Pollock"</span> <span class="o">-&gt;</span> <span class="s">"American"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornNationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Joan Miró"</span> <span class="o">-&gt;</span> <span class="s">"Spanish"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornNationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Piet Mondrian"</span> <span class="o">-&gt;</span> <span class="s">"Dutch"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornNationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Henri Matisse"</span> <span class="o">-&gt;</span> <span class="s">"French"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornNationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Kazimir Malevich"</span> <span class="o">-&gt;</span> <span class="s">"Russian"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornNationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Paul Gauguin"</span> <span class="o">-&gt;</span> <span class="s">"French"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornNationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Georges Braque"</span> <span class="o">-&gt;</span> <span class="s">"French"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornNationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Paul Cézanne"</span> <span class="o">-&gt;</span> <span class="s">"French"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornNationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Franz Marc"</span> <span class="o">-&gt;</span> <span class="s">"German"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornNationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Marc Chagall"</span> <span class="o">-&gt;</span> <span class="s">"Russian"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornNationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Claude Monet"</span> <span class="o">-&gt;</span> <span class="s">"French"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornNationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Max Beckmann"</span> <span class="o">-&gt;</span> <span class="s">"German"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornNationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Egon Schiele"</span> <span class="o">-&gt;</span> <span class="s">"Austrian"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornNationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Oskar Kokoschka"</span> <span class="o">-&gt;</span> <span class="s">"Austrian"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornNationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Paul Klee"</span> <span class="o">-&gt;</span> <span class="s">"Swiss"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornNationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Vasily Kandinsky"</span> <span class="o">-&gt;</span> <span class="s">"Russian"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornNationality</span><span class="err">"</span><span class="o">];</span>
<span class="s">"Natalia Goncharova"</span> <span class="o">-&gt;</span> <span class="s">"Russian"</span> <span class="o">[</span><span class="kt">label=</span><span class="err">"</span><span class="kt">bornNationality</span><span class="err">"</span><span class="o">];</span></code></pre></figure>

Artists' born nationalities:
<a href="#">
    <img src="/img/moma5.jpg" alt="Post Sample Image" width="500" height="700" />
</a>


<p><h3>Join All Graphs</h3>
To put Artists Bio into the same graph we can calculate nodes and edges for Gender, BeginDate and EndDate, then union them with nodes and edges we created (country of birth, nationality and born nationality) and build a graph. </p>
<p>Another way to build a knowledge graph is to automate the process. Get column names for nodes and edges:</p>


<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">artistBio</span><span class="k">=</span><span class="n">artistBornNationality</span><span class="o">.</span><span class="n">drop</span><span class="o">(</span><span class="s">"ArtistBio"</span><span class="o">)</span>
<span class="k">val</span> <span class="n">columnList</span><span class="k">=</span><span class="n">artistBio</span><span class="o">.</span><span class="n">columns</span>
<span class="nc">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(</span><span class="nc">Artist</span><span class="o">,</span> <span class="nc">BeginDate</span><span class="o">,</span> <span class="nc">EndDate</span><span class="o">,</span> <span class="nc">Nationality</span><span class="o">,</span> <span class="nc">Gender</span><span class="o">,</span> <span class="n">bornInCountry</span><span class="o">,</span> <span class="n">bornNationality</span><span class="o">)</span></code></pre></figure>


<p>Create edges for {'Artist', 'other column'} pairs and nodes for all columns:</p>


<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">var</span> <span class="n">graphNodes</span><span class="k">:</span> <span class="kt">DataFrame</span> <span class="o">=</span><span class="nc">Seq</span><span class="o">((</span><span class="s">""</span><span class="o">)).</span><span class="n">toDF</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span>
<span class="k">var</span> <span class="n">graphEdges</span><span class="k">:</span> <span class="kt">DataFrame</span> <span class="o">=</span><span class="nc">Seq</span><span class="o">((</span><span class="s">""</span><span class="o">,</span><span class="s">""</span><span class="o">,</span><span class="s">""</span><span class="o">)).</span><span class="n">toDF</span><span class="o">(</span><span class="s">"src"</span><span class="o">,</span><span class="s">"dst"</span><span class="o">,</span><span class="s">"edgeId"</span><span class="o">)</span>
<span class="k">var</span> <span class="n">idx</span><span class="k">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="o">(</span><span class="n">column</span> <span class="k">&lt;-</span> <span class="n">columnList</span> <span class="o">)</span> <span class="o">{</span>  
  <span class="n">graphNodes</span><span class="k">=</span><span class="n">graphNodes</span><span class="o">.</span><span class="n">union</span><span class="o">(</span><span class="n">artistBio</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="n">column</span><span class="o">))</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">idx</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">graphEdges</span><span class="k">=</span><span class="n">graphEdges</span><span class="o">.</span><span class="n">union</span><span class="o">(</span><span class="n">artistBio</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="n">artistBio</span><span class="o">.</span><span class="n">columns</span><span class="o">(</span><span class="mi">0</span><span class="o">),</span><span class="n">column</span><span class="o">).</span>
      <span class="n">toDF</span><span class="o">(</span><span class="s">"src"</span><span class="o">,</span><span class="s">"dst"</span><span class="o">).</span><span class="n">withColumn</span><span class="o">(</span><span class="s">"edgeId"</span><span class="o">,</span><span class="n">lit</span><span class="o">(</span><span class="n">column</span><span class="o">)))</span>
  <span class="o">}</span>
  <span class="n">idx</span><span class="k">=</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span>
 <span class="o">}</span></code></pre></figure>



<p>Edges:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">display</span><span class="o">(</span><span class="n">graphEdges</span><span class="o">.</span><span class="n">orderBy</span><span class="o">(</span><span class="s">"src"</span><span class="o">,</span><span class="s">"edgeId"</span><span class="o">))</span>
<span class="nc">Claude</span> <span class="nc">Monet</span><span class="o">,</span><span class="mi">1840</span><span class="o">,</span><span class="nc">BeginDate</span>
<span class="nc">Claude</span> <span class="nc">Monet</span><span class="o">,</span><span class="mi">1926</span><span class="o">,</span><span class="nc">EndDate</span>
<span class="nc">Claude</span> <span class="nc">Monet</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">Gender</span>
<span class="nc">Claude</span> <span class="nc">Monet</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Claude</span> <span class="nc">Monet</span><span class="o">,</span><span class="nc">France</span><span class="o">,</span><span class="n">bornInCountry</span>
<span class="nc">Claude</span> <span class="nc">Monet</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="n">bornNationality</span>
<span class="nc">Egon</span> <span class="nc">Schiele</span><span class="o">,</span><span class="mi">1890</span><span class="o">,</span><span class="nc">BeginDate</span>
<span class="nc">Egon</span> <span class="nc">Schiele</span><span class="o">,</span><span class="mi">1918</span><span class="o">,</span><span class="nc">EndDate</span>
<span class="nc">Egon</span> <span class="nc">Schiele</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">Gender</span>
<span class="nc">Egon</span> <span class="nc">Schiele</span><span class="o">,</span><span class="nc">Austrian</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Egon</span> <span class="nc">Schiele</span><span class="o">,</span><span class="nc">Austria</span><span class="o">,</span><span class="n">bornInCountry</span>
<span class="nc">Egon</span> <span class="nc">Schiele</span><span class="o">,</span><span class="nc">Austrian</span><span class="o">,</span><span class="n">bornNationality</span>
<span class="nc">Franz</span> <span class="nc">Marc</span><span class="o">,</span><span class="mi">1880</span><span class="o">,</span><span class="nc">BeginDate</span>
<span class="nc">Franz</span> <span class="nc">Marc</span><span class="o">,</span><span class="mi">1916</span><span class="o">,</span><span class="nc">EndDate</span>
<span class="nc">Franz</span> <span class="nc">Marc</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">Gender</span>
<span class="nc">Franz</span> <span class="nc">Marc</span><span class="o">,</span><span class="nc">German</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Franz</span> <span class="nc">Marc</span><span class="o">,</span><span class="nc">Germany</span><span class="o">,</span><span class="n">bornInCountry</span>
<span class="nc">Franz</span> <span class="nc">Marc</span><span class="o">,</span><span class="nc">German</span><span class="o">,</span><span class="n">bornNationality</span>
<span class="nc">Georges</span> <span class="nc">Braque</span><span class="o">,</span><span class="mi">1882</span><span class="o">,</span><span class="nc">BeginDate</span>
<span class="nc">Georges</span> <span class="nc">Braque</span><span class="o">,</span><span class="mi">1963</span><span class="o">,</span><span class="nc">EndDate</span>
<span class="nc">Georges</span> <span class="nc">Braque</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">Gender</span>
<span class="nc">Georges</span> <span class="nc">Braque</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Georges</span> <span class="nc">Braque</span><span class="o">,</span><span class="nc">France</span><span class="o">,</span><span class="n">bornInCountry</span>
<span class="nc">Georges</span> <span class="nc">Braque</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="n">bornNationality</span>
<span class="nc">Henri</span> <span class="nc">Matisse</span><span class="o">,</span><span class="mi">1869</span><span class="o">,</span><span class="nc">BeginDate</span>
<span class="nc">Henri</span> <span class="nc">Matisse</span><span class="o">,</span><span class="mi">1954</span><span class="o">,</span><span class="nc">EndDate</span>
<span class="nc">Henri</span> <span class="nc">Matisse</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">Gender</span>
<span class="nc">Henri</span> <span class="nc">Matisse</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Henri</span> <span class="nc">Matisse</span><span class="o">,</span><span class="nc">France</span><span class="o">,</span><span class="n">bornInCountry</span>
<span class="nc">Henri</span> <span class="nc">Matisse</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="n">bornNationality</span>
<span class="nc">Jackson</span> <span class="nc">Pollock</span><span class="o">,</span><span class="mi">1912</span><span class="o">,</span><span class="nc">BeginDate</span>
<span class="nc">Jackson</span> <span class="nc">Pollock</span><span class="o">,</span><span class="mi">1956</span><span class="o">,</span><span class="nc">EndDate</span>
<span class="nc">Jackson</span> <span class="nc">Pollock</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">Gender</span>
<span class="nc">Jackson</span> <span class="nc">Pollock</span><span class="o">,</span><span class="nc">American</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Jackson</span> <span class="nc">Pollock</span><span class="o">,</span><span class="nc">USA</span><span class="o">,</span><span class="n">bornInCountry</span>
<span class="nc">Jackson</span> <span class="nc">Pollock</span><span class="o">,</span><span class="nc">American</span><span class="o">,</span><span class="n">bornNationality</span>
<span class="nc">Joan</span> <span class="nc">Miró</span><span class="o">,</span><span class="mi">1893</span><span class="o">,</span><span class="nc">BeginDate</span>
<span class="nc">Joan</span> <span class="nc">Miró</span><span class="o">,</span><span class="mi">1983</span><span class="o">,</span><span class="nc">EndDate</span>
<span class="nc">Joan</span> <span class="nc">Miró</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">Gender</span>
<span class="nc">Joan</span> <span class="nc">Miró</span><span class="o">,</span><span class="nc">Spanish</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Joan</span> <span class="nc">Miró</span><span class="o">,</span><span class="nc">Spain</span><span class="o">,</span><span class="n">bornInCountry</span>
<span class="nc">Joan</span> <span class="nc">Miró</span><span class="o">,</span><span class="nc">Spanish</span><span class="o">,</span><span class="n">bornNationality</span>
<span class="nc">Kazimir</span> <span class="nc">Malevich</span><span class="o">,</span><span class="mi">1878</span><span class="o">,</span><span class="nc">BeginDate</span>
<span class="nc">Kazimir</span> <span class="nc">Malevich</span><span class="o">,</span><span class="mi">1935</span><span class="o">,</span><span class="nc">EndDate</span>
<span class="nc">Kazimir</span> <span class="nc">Malevich</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">Gender</span>
<span class="nc">Kazimir</span> <span class="nc">Malevich</span><span class="o">,</span><span class="nc">Russian</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Kazimir</span> <span class="nc">Malevich</span><span class="o">,</span><span class="nc">Russian</span> <span class="nc">Empire</span><span class="o">,</span><span class="n">bornInCountry</span>
<span class="nc">Kazimir</span> <span class="nc">Malevich</span><span class="o">,</span><span class="nc">Russian</span><span class="o">,</span><span class="n">bornNationality</span>
<span class="nc">Marc</span> <span class="nc">Chagall</span><span class="o">,</span><span class="mi">1887</span><span class="o">,</span><span class="nc">BeginDate</span>
<span class="nc">Marc</span> <span class="nc">Chagall</span><span class="o">,</span><span class="mi">1985</span><span class="o">,</span><span class="nc">EndDate</span>
<span class="nc">Marc</span> <span class="nc">Chagall</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">Gender</span>
<span class="nc">Marc</span> <span class="nc">Chagall</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Marc</span> <span class="nc">Chagall</span><span class="o">,</span><span class="nc">Russian</span> <span class="nc">Empire</span><span class="o">,</span><span class="n">bornInCountry</span>
<span class="nc">Marc</span> <span class="nc">Chagall</span><span class="o">,</span><span class="nc">Russian</span><span class="o">,</span><span class="n">bornNationality</span>
<span class="nc">Max</span> <span class="nc">Beckmann</span><span class="o">,</span><span class="mi">1884</span><span class="o">,</span><span class="nc">BeginDate</span>
<span class="nc">Max</span> <span class="nc">Beckmann</span><span class="o">,</span><span class="mi">1950</span><span class="o">,</span><span class="nc">EndDate</span>
<span class="nc">Max</span> <span class="nc">Beckmann</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">Gender</span>
<span class="nc">Max</span> <span class="nc">Beckmann</span><span class="o">,</span><span class="nc">German</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Max</span> <span class="nc">Beckmann</span><span class="o">,</span><span class="nc">Germany</span><span class="o">,</span><span class="n">bornInCountry</span>
<span class="nc">Max</span> <span class="nc">Beckmann</span><span class="o">,</span><span class="nc">German</span><span class="o">,</span><span class="n">bornNationality</span>
<span class="nc">Natalia</span> <span class="nc">Goncharova</span><span class="o">,</span><span class="mi">1881</span><span class="o">,</span><span class="nc">BeginDate</span>
<span class="nc">Natalia</span> <span class="nc">Goncharova</span><span class="o">,</span><span class="mi">1962</span><span class="o">,</span><span class="nc">EndDate</span>
<span class="nc">Natalia</span> <span class="nc">Goncharova</span><span class="o">,</span><span class="nc">Female</span><span class="o">,</span><span class="nc">Gender</span>
<span class="nc">Natalia</span> <span class="nc">Goncharova</span><span class="o">,</span><span class="nc">Russian</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Natalia</span> <span class="nc">Goncharova</span><span class="o">,</span><span class="nc">Russian</span> <span class="nc">Empire</span><span class="o">,</span><span class="n">bornInCountry</span>
<span class="nc">Natalia</span> <span class="nc">Goncharova</span><span class="o">,</span><span class="nc">Russian</span><span class="o">,</span><span class="n">bornNationality</span>
<span class="nc">Oskar</span> <span class="nc">Kokoschka</span><span class="o">,</span><span class="mi">1886</span><span class="o">,</span><span class="nc">BeginDate</span>
<span class="nc">Oskar</span> <span class="nc">Kokoschka</span><span class="o">,</span><span class="mi">1980</span><span class="o">,</span><span class="nc">EndDate</span>
<span class="nc">Oskar</span> <span class="nc">Kokoschka</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">Gender</span>
<span class="nc">Oskar</span> <span class="nc">Kokoschka</span><span class="o">,</span><span class="nc">Austrian</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Oskar</span> <span class="nc">Kokoschka</span><span class="o">,</span><span class="nc">Austria</span><span class="o">,</span><span class="n">bornInCountry</span>
<span class="nc">Oskar</span> <span class="nc">Kokoschka</span><span class="o">,</span><span class="nc">Austrian</span><span class="o">,</span><span class="n">bornNationality</span>
<span class="nc">Pablo</span> <span class="nc">Picasso</span><span class="o">,</span><span class="mi">1881</span><span class="o">,</span><span class="nc">BeginDate</span>
<span class="nc">Pablo</span> <span class="nc">Picasso</span><span class="o">,</span><span class="mi">1973</span><span class="o">,</span><span class="nc">EndDate</span>
<span class="nc">Pablo</span> <span class="nc">Picasso</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">Gender</span>
<span class="nc">Pablo</span> <span class="nc">Picasso</span><span class="o">,</span><span class="nc">Spanish</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Pablo</span> <span class="nc">Picasso</span><span class="o">,</span><span class="nc">Spain</span><span class="o">,</span><span class="n">bornInCountry</span>
<span class="nc">Pablo</span> <span class="nc">Picasso</span><span class="o">,</span><span class="nc">Spanish</span><span class="o">,</span><span class="n">bornNationality</span>
<span class="nc">Paul</span> <span class="nc">Cézanne</span><span class="o">,</span><span class="mi">1839</span><span class="o">,</span><span class="nc">BeginDate</span>
<span class="nc">Paul</span> <span class="nc">Cézanne</span><span class="o">,</span><span class="mi">1906</span><span class="o">,</span><span class="nc">EndDate</span>
<span class="nc">Paul</span> <span class="nc">Cézanne</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">Gender</span>
<span class="nc">Paul</span> <span class="nc">Cézanne</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Paul</span> <span class="nc">Cézanne</span><span class="o">,</span><span class="nc">France</span><span class="o">,</span><span class="n">bornInCountry</span>
<span class="nc">Paul</span> <span class="nc">Cézanne</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="n">bornNationality</span>
<span class="nc">Paul</span> <span class="nc">Gauguin</span><span class="o">,</span><span class="mi">1848</span><span class="o">,</span><span class="nc">BeginDate</span>
<span class="nc">Paul</span> <span class="nc">Gauguin</span><span class="o">,</span><span class="mi">1903</span><span class="o">,</span><span class="nc">EndDate</span>
<span class="nc">Paul</span> <span class="nc">Gauguin</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">Gender</span>
<span class="nc">Paul</span> <span class="nc">Gauguin</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Paul</span> <span class="nc">Gauguin</span><span class="o">,</span><span class="nc">France</span><span class="o">,</span><span class="n">bornInCountry</span>
<span class="nc">Paul</span> <span class="nc">Gauguin</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="n">bornNationality</span>
<span class="nc">Paul</span> <span class="nc">Klee</span><span class="o">,</span><span class="mi">1879</span><span class="o">,</span><span class="nc">BeginDate</span>
<span class="nc">Paul</span> <span class="nc">Klee</span><span class="o">,</span><span class="mi">1940</span><span class="o">,</span><span class="nc">EndDate</span>
<span class="nc">Paul</span> <span class="nc">Klee</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">Gender</span>
<span class="nc">Paul</span> <span class="nc">Klee</span><span class="o">,</span><span class="nc">German</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Paul</span> <span class="nc">Klee</span><span class="o">,</span><span class="nc">Switzerland</span><span class="o">,</span><span class="n">bornInCountry</span>
<span class="nc">Paul</span> <span class="nc">Klee</span><span class="o">,</span><span class="nc">Swiss</span><span class="o">,</span><span class="n">bornNationality</span>
<span class="nc">Paul</span> <span class="nc">Signac</span><span class="o">,</span><span class="mi">1863</span><span class="o">,</span><span class="nc">BeginDate</span>
<span class="nc">Paul</span> <span class="nc">Signac</span><span class="o">,</span><span class="mi">1935</span><span class="o">,</span><span class="nc">EndDate</span>
<span class="nc">Paul</span> <span class="nc">Signac</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">Gender</span>
<span class="nc">Paul</span> <span class="nc">Signac</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Paul</span> <span class="nc">Signac</span><span class="o">,</span><span class="nc">France</span><span class="o">,</span><span class="n">bornInCountry</span>
<span class="nc">Paul</span> <span class="nc">Signac</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="n">bornNationality</span>
<span class="nc">Piet</span> <span class="nc">Mondrian</span><span class="o">,</span><span class="mi">1872</span><span class="o">,</span><span class="nc">BeginDate</span>
<span class="nc">Piet</span> <span class="nc">Mondrian</span><span class="o">,</span><span class="mi">1944</span><span class="o">,</span><span class="nc">EndDate</span>
<span class="nc">Piet</span> <span class="nc">Mondrian</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">Gender</span>
<span class="nc">Piet</span> <span class="nc">Mondrian</span><span class="o">,</span><span class="nc">Dutch</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Piet</span> <span class="nc">Mondrian</span><span class="o">,</span><span class="nc">Netherlands</span><span class="o">,</span><span class="n">bornInCountry</span>
<span class="nc">Piet</span> <span class="nc">Mondrian</span><span class="o">,</span><span class="nc">Dutch</span><span class="o">,</span><span class="n">bornNationality</span>
<span class="nc">Vasily</span> <span class="nc">Kandinsky</span><span class="o">,</span><span class="mi">1866</span><span class="o">,</span><span class="nc">BeginDate</span>
<span class="nc">Vasily</span> <span class="nc">Kandinsky</span><span class="o">,</span><span class="mi">1944</span><span class="o">,</span><span class="nc">EndDate</span>
<span class="nc">Vasily</span> <span class="nc">Kandinsky</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">Gender</span>
<span class="nc">Vasily</span> <span class="nc">Kandinsky</span><span class="o">,</span><span class="nc">French</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Vasily</span> <span class="nc">Kandinsky</span><span class="o">,</span><span class="nc">Russian</span> <span class="nc">Empire</span><span class="o">,</span><span class="n">bornInCountry</span>
<span class="nc">Vasily</span> <span class="nc">Kandinsky</span><span class="o">,</span><span class="nc">Russian</span><span class="o">,</span><span class="n">bornNationality</span>
<span class="nc">Vincent</span> <span class="n">van</span> <span class="nc">Gogh</span><span class="o">,</span><span class="mi">1853</span><span class="o">,</span><span class="nc">BeginDate</span>
<span class="nc">Vincent</span> <span class="n">van</span> <span class="nc">Gogh</span><span class="o">,</span><span class="mi">1890</span><span class="o">,</span><span class="nc">EndDate</span>
<span class="nc">Vincent</span> <span class="n">van</span> <span class="nc">Gogh</span><span class="o">,</span><span class="nc">Male</span><span class="o">,</span><span class="nc">Gender</span>
<span class="nc">Vincent</span> <span class="n">van</span> <span class="nc">Gogh</span><span class="o">,</span><span class="nc">Dutch</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Vincent</span> <span class="n">van</span> <span class="nc">Gogh</span><span class="o">,</span><span class="nc">Netherlands</span><span class="o">,</span><span class="n">bornInCountry</span>
<span class="nc">Vincent</span> <span class="n">van</span> <span class="nc">Gogh</span><span class="o">,</span><span class="nc">Dutch</span><span class="o">,</span><span class="n">bornNationality</span></code></pre></figure>


<p>Build a knowledge graph:</p>


<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">graphNodesArtistBio</span><span class="k">=</span><span class="n">graphNodes</span><span class="o">.</span><span class="n">filter</span><span class="o">(</span><span class="ss">'id=</span><span class="o">!=</span><span class="s">""</span><span class="o">).</span><span class="n">distinct</span>
<span class="k">val</span> <span class="n">graphEdgesArtistBio</span><span class="k">=</span><span class="n">graphEdges</span><span class="o">.</span><span class="n">filter</span><span class="o">(</span><span class="ss">'src=</span><span class="o">!=</span><span class="s">""</span><span class="o">).</span><span class="n">distinct</span>
<span class="k">val</span> <span class="n">graphArtistBio</span> <span class="k">=</span> <span class="nc">GraphFrame</span><span class="o">(</span><span class="n">graphNodesArtistBio</span><span class="o">,</span><span class="n">graphEdgesArtistBio</span><span class="o">)</span></code></pre></figure>



<p>Save a graph nodes and edges for future posts:</p>


<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">graphArtistBio</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">parquet</span><span class="o">(</span><span class="s">"graphNodesArtistBio"</span><span class="o">)</span>
<span class="n">graphArtistBio</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">parquet</span><span class="o">(</span><span class="s">"graphEdgesArtistBio"</span><span class="o">)</span></code></pre></figure>


<p>Reload graph nodes and edges and rebuild knowledge graph:</p>


<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">graphArtistNodes</span> <span class="k">=</span> <span class="n">sqlContext</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">parquet</span><span class="o">(</span><span class="s">"graphNodesArtistBio"</span><span class="o">)</span>
<span class="k">val</span> <span class="n">graphArtistEdges</span> <span class="k">=</span> <span class="n">sqlContext</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">parquet</span><span class="o">(</span><span class="s">"graphEdgesArtistBio"</span><span class="o">)</span>
<span class="k">val</span> <span class="n">graphArtist</span> <span class="k">=</span> <span class="nc">GraphFrame</span><span class="o">(</span><span class="n">graphArtistNodes</span><span class="o">,</span> <span class="n">graphArtistEdges</span><span class="o">)</span></code></pre></figure>


<a href="#">
    <img src="/img/moma3.jpg" alt="Post Sample Image" width="888" height="600" />
</a>

<p><h3>Knowledge Graph for Data Mining</h3>
Traditionally knowledge graph data analysis is using SPARQL language. Instead of SPARQL we will use:
<ul>
<li>Spark DataFrame language</li>
<li>Spark GraphFrames we will use a graph query language - motif 'find' function.</li>
</ul>

<p><h4>Artists that Changed Nationalities</h4>
<p>To see which artists changed their nationalities we can query ArtistBio table using Spark DataFrame language:</p>


<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">diffNationalityDF</span><span class="k">=</span><span class="n">artistBio</span><span class="o">.</span><span class="n">filter</span><span class="o">(</span><span class="ss">'Nationality=</span><span class="o">!='</span><span class="n">bornNationality</span><span class="o">).</span>
  <span class="n">select</span><span class="o">(</span><span class="s">"Artist"</span><span class="o">,</span><span class="s">"bornNationality"</span><span class="o">,</span><span class="s">"Nationality"</span><span class="o">)</span>

<span class="nc">Artist</span><span class="o">,</span><span class="n">bornNationality</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Paul</span> <span class="nc">Klee</span><span class="o">,</span><span class="nc">Swiss</span><span class="o">,</span><span class="nc">German</span>
<span class="nc">Vasily</span> <span class="nc">Kandinsky</span><span class="o">,</span><span class="nc">Russian</span><span class="o">,</span><span class="nc">French</span>
<span class="nc">Marc</span> <span class="nc">Chagall</span><span class="o">,</span><span class="nc">Russian</span><span class="o">,</span><span class="nc">French</span></code></pre></figure>


<p>Or we can use graph query language - Spark GraphFrames Motif 'find' function:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">diffNationalityGF</span><span class="k">=</span><span class="n">graphArtist</span><span class="o">.</span>
   <span class="n">find</span><span class="o">(</span><span class="s">"(a) - [ab] -&gt; (b); (a) - [ac] -&gt; (c)"</span><span class="o">).</span>
   <span class="n">filter</span><span class="o">(</span><span class="n">$</span><span class="s">"ab.edgeId"</span><span class="o">===</span><span class="s">"bornNationality"</span><span class="o">).</span><span class="n">filter</span><span class="o">(</span><span class="n">$</span><span class="s">"ac.edgeId"</span><span class="o">===</span><span class="s">"Nationality"</span><span class="o">).</span>
   <span class="n">filter</span><span class="o">(</span><span class="n">not</span><span class="o">(</span><span class="n">$</span><span class="s">"c.id"</span><span class="o">.</span><span class="n">contains</span><span class="o">(</span><span class="n">$</span><span class="s">"b.id"</span><span class="o">))).</span>
   <span class="n">select</span><span class="o">(</span><span class="s">"a.id"</span><span class="o">,</span><span class="s">"b.id"</span><span class="o">,</span><span class="s">"c.id"</span><span class="o">).</span><span class="n">toDF</span><span class="o">(</span><span class="s">"Artist"</span><span class="o">,</span><span class="s">"bornNationality"</span><span class="o">,</span><span class="s">"Nationality"</span><span class="o">)</span>

<span class="nc">Artist</span><span class="o">,</span><span class="n">bornNationality</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Marc</span> <span class="nc">Chagall</span><span class="o">,</span><span class="nc">Russian</span><span class="o">,</span><span class="nc">French</span>
<span class="nc">Vasily</span> <span class="nc">Kandinsky</span><span class="o">,</span><span class="nc">Russian</span><span class="o">,</span><span class="nc">French</span>
<span class="nc">Paul</span> <span class="nc">Klee</span><span class="o">,</span><span class="nc">Swiss</span><span class="o">,</span><span class="nc">German</span></code></pre></figure>


<p><h4>Artists Born in the Same Country</h4>
<p>To find pairs of artists that were born in the same country using Spark DataFrame language we have to self-join ArtistBio table:</p>


<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">sameCountryBirthDF</span><span class="k">=</span><span class="n">artistBio</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="s">"Artist"</span><span class="o">,</span><span class="s">"bornInCountry"</span><span class="o">).</span>
  <span class="n">join</span><span class="o">(</span><span class="n">artistBio</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="s">"Artist"</span><span class="o">,</span><span class="s">"bornInCountry"</span><span class="o">).</span><span class="n">toDF</span><span class="o">(</span><span class="s">"Artist2"</span><span class="o">,</span><span class="s">"bornInCountry2"</span><span class="o">),</span>
  <span class="ss">'bornInCountry=</span><span class="o">=='</span><span class="n">bornInCountry2</span><span class="o">).</span>
  <span class="n">filter</span><span class="o">(</span><span class="ss">'Artist&lt;'Artist2)</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="s">"bornInCountry"</span><span class="o">,</span><span class="s">"Artist"</span><span class="o">,</span><span class="s">"Artist2"</span><span class="o">).</span><span class="n">distinct</span>

<span class="n">display</span><span class="o">(</span><span class="n">sameCountryBirthDF</span><span class="o">.</span><span class="n">filter</span><span class="o">(</span><span class="ss">'bornInCountry=</span><span class="o">==</span><span class="s">"Austria"</span><span class="o">))</span>
<span class="n">bornInCountry</span><span class="o">,</span><span class="nc">Artist1</span><span class="o">,</span><span class="nc">Artist2</span>
<span class="nc">Austria</span><span class="o">,</span><span class="nc">Egon</span> <span class="nc">Schiele</span><span class="o">,</span><span class="nc">Oskar</span> <span class="nc">Kokoschka</span></code></pre></figure>


<p>Using motif 'find' function is an elegant way to find artists pairs: </p>


<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">sameCountryBirthGF</span><span class="k">=</span><span class="n">graphArtist</span><span class="o">.</span>
   <span class="n">find</span><span class="o">(</span><span class="s">"(a) - [ac] -&gt; (c); (b) - [bc] -&gt; (c)"</span><span class="o">).</span>
   <span class="n">filter</span><span class="o">(</span><span class="n">$</span><span class="s">"ac.edgeId"</span><span class="o">===</span><span class="n">$</span><span class="s">"bc.edgeId"</span> <span class="o">&amp;&amp;</span> <span class="n">$</span><span class="s">"ac.edgeId"</span><span class="o">===</span><span class="s">"bornInCountry"</span><span class="o">).</span>
   <span class="n">filter</span><span class="o">(</span><span class="n">$</span><span class="s">"a.id"</span><span class="o">&lt;</span><span class="n">$</span><span class="s">"b.id"</span><span class="o">).</span>
   <span class="n">select</span><span class="o">(</span><span class="s">"c.id"</span><span class="o">,</span><span class="s">"a.id"</span><span class="o">,</span><span class="s">"b.id"</span><span class="o">).</span><span class="n">toDF</span><span class="o">(</span><span class="s">"bornInCountry"</span><span class="o">,</span><span class="s">"Artist1"</span><span class="o">,</span><span class="s">"Artist2"</span><span class="o">).</span><span class="n">distinct</span>

<span class="n">display</span><span class="o">(</span><span class="n">sameCountryBirthGF</span><span class="o">.</span><span class="n">filter</span><span class="o">(</span><span class="ss">'bornInCountry=</span><span class="o">==</span><span class="s">"Austria"</span><span class="o">))</span>
<span class="n">bornInCountry</span><span class="o">,</span><span class="nc">Artist1</span><span class="o">,</span><span class="nc">Artist2</span>
<span class="nc">Austria</span><span class="o">,</span><span class="nc">Egon</span> <span class="nc">Schiele</span><span class="o">,</span><span class="nc">Oskar</span> <span class="nc">Kokoschka</span></code></pre></figure>


<p><h4>Biography Relationships</h4>

<p>(Subject, Object, Predicate) data structure is different that tabular data structure in particularly it  builds and explains data relationships. The graphArtist graph shows groups of artists that were born in the same country, had same nationality or same gender. Are there any other Artists relationships?</p>


<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">sharedPredicates</span><span class="k">=</span><span class="n">graphArtist</span><span class="o">.</span>
   <span class="n">find</span><span class="o">(</span><span class="s">"(a) - [ac] -&gt; (c); (b) - [bc] -&gt; (c)"</span><span class="o">).</span>
   <span class="n">filter</span><span class="o">(</span><span class="n">$</span><span class="s">"a.id"</span><span class="o">=!=</span><span class="n">$</span><span class="s">"b.id"</span><span class="o">).</span>
   <span class="n">filter</span><span class="o">(</span><span class="n">$</span><span class="s">"ac.edgeId"</span> <span class="o">&lt;=</span> <span class="n">$</span><span class="s">"bc.edgeId"</span><span class="o">).</span>
   <span class="n">select</span><span class="o">(</span><span class="s">"ac.edgeId"</span><span class="o">,</span><span class="s">"bc.edgeId"</span><span class="o">).</span>
   <span class="n">toDF</span><span class="o">(</span><span class="s">"predicate1"</span><span class="o">,</span><span class="s">"predicate2"</span><span class="o">).</span><span class="n">distinct</span>

<span class="n">display</span><span class="o">(</span><span class="n">sharedPredicates</span><span class="o">.</span><span class="n">orderBy</span><span class="o">(</span><span class="s">"predicate1"</span><span class="o">,</span><span class="s">"predicate2"</span><span class="o">))</span>
<span class="n">predicate1</span><span class="o">,</span><span class="n">predicate2</span>
<span class="nc">BeginDate</span><span class="o">,</span><span class="nc">BeginDate</span>
<span class="nc">BeginDate</span><span class="o">,</span><span class="nc">EndDate</span>
<span class="nc">EndDate</span><span class="o">,</span><span class="nc">EndDate</span>
<span class="nc">Gender</span><span class="o">,</span><span class="nc">Gender</span>
<span class="nc">Nationality</span><span class="o">,</span><span class="nc">Nationality</span>
<span class="nc">Nationality</span><span class="o">,</span><span class="n">bornNationality</span>
<span class="n">bornInCountry</span><span class="o">,</span><span class="n">bornInCountry</span>
<span class="n">bornNationality</span><span class="o">,</span><span class="n">bornNationality</span></code></pre></figure>


<p>The same years in artist biographies:</p>


<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">sameDates</span><span class="k">=</span><span class="n">graphArtist</span><span class="o">.</span>
   <span class="n">find</span><span class="o">(</span><span class="s">"(a) - [ac] -&gt; (c); (b) - [bc] -&gt; (c)"</span><span class="o">).</span>
   <span class="n">filter</span><span class="o">(</span><span class="n">$</span><span class="s">"a.id"</span> <span class="o">&lt;</span> <span class="n">$</span><span class="s">"b.id"</span><span class="o">).</span><span class="n">filter</span><span class="o">(</span><span class="n">$</span><span class="s">"ac.edgeId"</span><span class="o">.</span><span class="n">rlike</span><span class="o">(</span><span class="s">"Date"</span><span class="o">)).</span>
   <span class="n">select</span><span class="o">(</span><span class="s">"c.id"</span><span class="o">,</span><span class="s">"a.id"</span><span class="o">,</span><span class="s">"ac.edgeId"</span><span class="o">,</span><span class="s">"b.id"</span><span class="o">,</span><span class="s">"bc.edgeId"</span><span class="o">).</span>
   <span class="n">toDF</span><span class="o">(</span><span class="s">"SameYear"</span><span class="o">,</span><span class="s">"Artist1"</span><span class="o">,</span><span class="s">"Year1"</span><span class="o">,</span><span class="s">"Artist2"</span><span class="o">,</span><span class="s">"Year2"</span><span class="o">).</span><span class="n">distinct</span>

<span class="n">display</span><span class="o">(</span><span class="n">sameDates</span><span class="o">.</span><span class="n">orderBy</span><span class="o">(</span><span class="ss">'SameYear)</span><span class="o">)</span>
<span class="nc">SameYear</span><span class="o">,</span><span class="nc">Artist1</span><span class="o">,</span><span class="nc">Year1</span><span class="o">,</span><span class="nc">Artist2</span><span class="o">,</span><span class="nc">Year2</span>
<span class="mi">1881</span><span class="o">,</span><span class="nc">Natalia</span> <span class="nc">Goncharova</span><span class="o">,</span><span class="nc">BeginDate</span><span class="o">,</span><span class="nc">Pablo</span> <span class="nc">Picasso</span><span class="o">,</span><span class="nc">BeginDate</span>
<span class="mi">1890</span><span class="o">,</span><span class="nc">Egon</span> <span class="nc">Schiele</span><span class="o">,</span><span class="nc">BeginDate</span><span class="o">,</span><span class="nc">Vincent</span> <span class="n">van</span> <span class="nc">Gogh</span><span class="o">,</span><span class="nc">EndDate</span>
<span class="mi">1935</span><span class="o">,</span><span class="nc">Kazimir</span> <span class="nc">Malevich</span><span class="o">,</span><span class="nc">EndDate</span><span class="o">,</span><span class="nc">Paul</span> <span class="nc">Signac</span><span class="o">,</span><span class="nc">EndDate</span>
<span class="mi">1944</span><span class="o">,</span><span class="nc">Piet</span> <span class="nc">Mondrian</span><span class="o">,</span><span class="nc">EndDate</span><span class="o">,</span><span class="nc">Vasily</span> <span class="nc">Kandinsky</span><span class="o">,</span><span class="nc">EndDate</span></code></pre></figure>



<p><h3>Next Post - Paintings</h3>
In the next several posts we will deeper look at MoMA dataset.</p>
</p></p></p></p></p></p>


                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2019/06/01/word2vec2CNN/" data-toggle="tooltip" data-placement="top" title="Free Associations ">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2019/12/21/knowledgeGraphSemantics/" data-toggle="tooltip" data-placement="top" title="Knowledge Graph for Semantic Data Mining">Next Post &rarr;</a>
                    </li>
                    
                </ul>

            </div>
        </div>
    </div>
</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                    <li>
                        <a href="mailto:sparkling.dataocean@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; Melenar 2024</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>


    
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-114694347-1', 'auto');
  ga('send', 'pageview');

</script>



</body>

</html>
